<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../../../Code/代码和笔记/Day03_AJAX原理/03-code/11-14.案例_天气预报/css/reset.css">
  <link rel="stylesheet" href="../../../../Code/代码和笔记/Day03_AJAX原理/03-code/11-14.案例_天气预报/css/index.css">
  <title>案例_天气预报</title>
</head>
<!-- /Users/mhhui/Code/代码和笔记/Day03_AJAX原理/03-code/11-14.案例_天气预报 -->
<!-- ../../../../Code/代码和笔记/Day03_AJAX原理/03-code/11-14.案例_天气预报 -->

<body>
  <div class="container">
    <!-- 顶部 -->
    <div class="top-box">
      <div class="title">
        <span class="dateShort">10月28日</span>
        <span class="calendar">农历&nbsp;
          <span class="dateLunar">十月初四</span>
        </span>
      </div>
      <div class="search-box">
        <div class="location">
          <img src="./imgs/定位.png" alt="">
          <span class="area">城市名</span>
        </div>
        <!-- 搜索框+搜索列表 -->
        <div class="search">
          <input type="text" class="search-city" placeholder="搜索城市">
          <ul class="search-list">
            <li class="city-item">北京市</li>
          </ul>
        </div>
      </div>
    </div>
    <!-- 当前天气 -->
    <div class="weather-box">
      <div class="tem-box">
        <span class="temp">
          <span class="temperature">12</span>
          <span>°</span>
        </span>
      </div>
      <div class="climate-box">
        <div class="air">
          <span class="psPm25">55</span>
          <span class="psPm25Level">良</span>
        </div>
        <ul class="weather-list">
          <li>
            <img src="./imgs/小雨-line.png" class="weatherImg" alt="">
            <span class="weather">多云</span>
          </li>
          <li class="windDirection">东南风</li>
          <li class="windPower">2级</li>
        </ul>
      </div>
    </div>
    <div class="today-weather">
      <div class="range-box">
        <span>今天：</span>
        <span class="range">
          <span class="weather">晴</span>
          <span class="temNight">9</span>
          <span>-</span>
          <span class="temDay">14</span>
          <span>℃</span>
        </span>
      </div>
      <ul class="sun-list">
        <li>
          <span>紫外线</span>
          <span class="ultraviolet">强</span>
        </li>
        <li>
          <span>湿度</span>
          <span class="humidity">53</span>%
        </li>
        <li>
          <span>日出</span>
          <span class="sunriseTime">06:38</span>
        </li>
        <li>
          <span>日落</span>
          <span class="sunsetTime">17:18</span>
        </li>
      </ul>
    </div>
    <!-- 周天气预报 -->
    <div class="week-weather-box">
      <div class="title">7日内天气预报</div>
      <ul class="week-wrap">
        <li class="item">
          <div class="date-box">
            <span class="dateFormat">今天</span>
            <span class="date">10月28日</span>
          </div>
          <img src="./imgs/多云.png" alt="" class="weatherImg">
          <span class="weather">多云</span>
          <div class="temp">
            <span class="temNight">12</span>-
            <span class="temDay">12</span>
            <span>℃</span>
          </div>
          <div class="wind">
            <span class="windDirection">东南风</span>
            <span class="windPower">&lt;3级</span>
          </div>
        </li>
        <li class="item">
          <div class="date-box">
            <span class="dateFormat">今天</span>
            <span class="date">10月28日</span>
          </div>
          <img src="./imgs/多云.png" alt="" class="weatherImg">
          <span class="weather">多云</span>
          <div class="temp">
            <span class="temDay">12</span>-
            <span class="temNight">12</span>
            <span>℃</span>
          </div>
          <div class="wind">
            <span class="windDirection">东南风</span>
            <span class="windPower">&lt;3级</span>
          </div>
        </li>
        <li class="item">
          <div class="date-box">
            <span class="dateFormat">今天</span>
            <span class="date">10月28日</span>
          </div>
          <img src="./imgs/多云.png" alt="" class="weatherImg">
          <span class="weather">多云</span>
          <div class="temp">
            <span class="temDay">12</span>-
            <span class="temNight">12</span>
            <span>℃</span>
          </div>
          <div class="wind">
            <span class="windDirection">东南风</span>
            <span class="windPower">&lt;3级</span>
          </div>
        </li>
        <li class="item">
          <div class="date-box">
            <span class="dateFormat">今天</span>
            <span class="date">10月28日</span>
          </div>
          <img src="./imgs/多云.png" alt="" class="weatherImg">
          <span class="weather">多云</span>
          <div class="temp">
            <span class="temDay">12</span>-
            <span class="temNight">12</span>
            <span>℃</span>
          </div>
          <div class="wind">
            <span class="windDirection">东南风</span>
            <span class="windPower">&lt;3级</span>
          </div>
        </li>
        <li class="item">
          <div class="date-box">
            <span class="dateFormat">今天</span>
            <span class="date">10月28日</span>
          </div>
          <img src="./imgs/多云.png" alt="" class="weatherImg">
          <span class="weather">多云</span>
          <div class="temp">
            <span class="temDay">12</span>-
            <span class="temNight">12</span>
            <span>℃</span>
          </div>
          <div class="wind">
            <span class="windDirection">东南风</span>
            <span class="windPower">&lt;3级</span>
          </div>
        </li>
        <li class="item">
          <div class="date-box">
            <span class="dateFormat">今天</span>
            <span class="date">10月28日</span>
          </div>
          <img src="./imgs/多云.png" alt="" class="weatherImg">
          <span class="weather">多云</span>
          <div class="temp">
            <span class="temDay">12</span>-
            <span class="temNight">12</span>
            <span>℃</span>
          </div>
          <div class="wind">
            <span class="windDirection">东南风</span>
            <span class="windPower">&lt;3级</span>
          </div>
        </li>
        <li class="item">
          <div class="date-box">
            <span class="dateFormat">今天</span>
            <span class="date">10月28日</span>
          </div>
          <img src="./imgs/多云.png" alt="" class="weatherImg">
          <span class="weather">多云</span>
          <div class="temp">
            <span class="temDay">12</span>-
            <span class="temNight">12</span>
            <span>℃</span>
          </div>
          <div class="wind">
            <span class="windDirection">东南风</span>
            <span class="windPower">&lt;3级</span>
          </div>
        </li>
      </ul>
    </div>
  </div>


  <!-- 自己封装myAxios函数 -->
  <!-- //review 接口gg了 -->
  <script>
    function myAxios(config) {
      return p = new Promise((passed, failed) => {
        const xhr = new XMLHttpRequest();
        let queryString, queryData;
        if (config.params) {
          queryString = new URLSearchParams(config.params).toString();
          config.url = config.url + '?' + queryString
        }

        xhr.open(config.method || 'get', config.url);
        xhr.addEventListener('loadend', () => {
          if (xhr.status >= 200 && xhr.status < 300) {
            passed(JSON.parse(xhr.response));
          } else failed(xhr.response);
        });

        if (config.data) {
          xhr.setRequestHeader('Content-Type', 'application/json')
          queryData = JSON.stringify(config.data)
          // console.log(queryData);
          xhr.send(queryData)
        } else {
          xhr.send();
        }
      });
    };
  </script>
  <!-- <script src="../../../../Code/代码和笔记/Day03_AJAX原理/03-code/11-14.案例_天气预报/js/my-axios.js"></script> -->


  <!-- 搜索框+下拉菜单出现逻辑 -->
  <script>

  </script>

  <!-- 核心js -->
  <script>
    /**
    * 目标1：默认显示-北京市天气
    *  1.1 获取北京市天气数据
    *  1.2 数据展示到页面
    */
    // 获取并渲染城市天气函数
    function getWeather(cityCode) {
      // 1.1 获取北京市天气数据
      myAxios({
        url: 'http://hmajax.itheima.net/api/weather',
        params: {
          city: cityCode
        }
      }).then(result => {
        // console.log(result)
        const wObj = result.data
        // 1.2 数据展示到页面
        // 阳历和农历日期
        const dateStr = `<span class="dateShort">${wObj.date}</span>
    <span class="calendar">农历&nbsp;
      <span class="dateLunar">${wObj.dateLunar}</span>
    </span>`
        document.querySelector('.title').innerHTML = dateStr
        // 城市名字
        document.querySelector('.area').innerHTML = wObj.area
        // 当天气温
        const nowWStr = `<div class="tem-box">
    <span class="temp">
      <span class="temperature">${wObj.temperature}</span>
      <span>°</span>
    </span>
  </div>
  <div class="climate-box">
    <div class="air">
      <span class="psPm25">${wObj.psPm25}</span>
      <span class="psPm25Level">${wObj.psPm25Level}</span>
    </div>
    <ul class="weather-list">
      <li>
        <img src="${wObj.weatherImg}" class="weatherImg" alt="">
        <span class="weather">${wObj.weather}</span>
      </li>
      <li class="windDirection">${wObj.windDirection}</li>
      <li class="windPower">${wObj.windPower}</li>
    </ul>
  </div>`
        document.querySelector('.weather-box').innerHTML = nowWStr
        // 当天天气
        const twObj = wObj.todayWeather
        const todayWStr = `<div class="range-box">
    <span>今天：</span>
    <span class="range">
      <span class="weather">${twObj.weather}</span>
      <span class="temNight">${twObj.temNight}</span>
      <span>-</span>
      <span class="temDay">${twObj.temDay}</span>
      <span>℃</span>
    </span>
  </div>
  <ul class="sun-list">
    <li>
      <span>紫外线</span>
      <span class="ultraviolet">${twObj.ultraviolet}</span>
    </li>
    <li>
      <span>湿度</span>
      <span class="humidity">${twObj.humidity}</span>%
    </li>
    <li>
      <span>日出</span>
      <span class="sunriseTime">${twObj.sunriseTime}</span>
    </li>
    <li>
      <span>日落</span>
      <span class="sunsetTime">${twObj.sunsetTime}</span>
    </li>
  </ul>`
        document.querySelector('.today-weather').innerHTML = todayWStr

        // 7日天气预报数据展示
        const dayForecast = wObj.dayForecast
        const dayForecastStr = dayForecast.map(item => {
          return `<li class="item">
      <div class="date-box">
        <span class="dateFormat">${item.dateFormat}</span>
        <span class="date">${item.date}</span>
      </div>
      <img src="${item.weatherImg}" alt="" class="weatherImg">
      <span class="weather">${item.weather}</span>
      <div class="temp">
        <span class="temNight">${item.temNight}</span>-
        <span class="temDay">${item.temDay}</span>
        <span>℃</span>
      </div>
      <div class="wind">
        <span class="windDirection">${item.windDirection}</span>
        <span class="windPower">${item.windPower}</span>
      </div>
    </li>`
        }).join('')
        // console.log(dayForecastStr)
        document.querySelector('.week-wrap').innerHTML = dayForecastStr
      })
    }

    // 默认进入网页-就要获取天气数据（北京市城市编码：'110100'）
    getWeather('110100')

    /**
     * 目标2：搜索城市列表
     *  2.1 绑定input事件，获取关键字
     *  2.2 获取展示城市列表数据
     */
    // 2.1 绑定input事件，获取关键字
    // document.querySelector('.search-city').addEventListener('input', (e) => {
    //   console.log(e.target.value)
    //   // 2.2 获取展示城市列表数据
    //   myAxios({
    //     url: 'http://hmajax.itheima.net/api/weather/city',
    //     params: {
    //       city: e.target.value
    //     }
    //   }).then(result => {
    //     console.log(result)
    //     const liStr = result.data.map(item => {
    //       return `<li class="city-item" data-code="${item.code}">${item.name}</li>`
    //     }).join('')
    //     console.log(liStr)
    //     document.querySelector('.search-list').innerHTML = liStr
    //   })
    // })
      document.querySelector('.search-city').addEventListener('input', (e)=>{
        console.log(e.target.value);
        myAxios({
          url: 'http://hmajax.itheima.net/api/weather/city',
          params:{
            city: e.target.vlaue,
          }
        }).then(result=>{
          console.log(result);
        })
      })



    /**
     * 目标3：切换城市天气
     *  3.1 绑定城市点击事件，获取城市code值
     *  3.2 调用获取并展示天气的函数
     */
    // 3.1 绑定城市点击事件，获取城市code值
    // document.querySelector('.search-list').addEventListener('click', e => {
    //   if (e.target.classList.contains('city-item')) {
    //     // 只有点击城市li才会走这里
    //     const cityCode = e.target.dataset.code
    //     console.log(cityCode)
    //     // 3.2 调用获取并展示天气的函数
    //     getWeather(cityCode)
    //   }
    // })
  </script>
</body>

</html>